name: Build Extensions (Personal Distribution)

on:
    push:
        tags:
            - "v*"
    workflow_dispatch:

jobs:
    build:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout code
              uses: actions/checkout@v4

            - name: Setup Bun
              uses: oven-sh/setup-bun@v1

            - name: Install dependencies
              run: bun install

            - name: Type check
              run: bun run typecheck

            - name: Build all
              run: bun run build:all

            - name: Build Firefox
              run: bun run build:firefox

            - name: Package Chrome
              run: bun run package:chrome

            - name: Package Firefox (unsigned)
              run: bun run package:firefox

            - name: Create Release
              uses: softprops/action-gh-release@v1
              with:
                  files: |
                      build/è‡ªå‹•å‡ºå¸­ãƒ•ã‚©ãƒ¼ãƒ  chrome.zip
                      build/è‡ªå‹•å‡ºå¸­ãƒ•ã‚©ãƒ¼ãƒ  firefox.zip
                  body: |
                      ## ğŸš€ è‡ªå‹•å‡ºå¸­ãƒ•ã‚©ãƒ¼ãƒ æ‹¡å¼µæ©Ÿèƒ½

                      ### Chrome
                      1. `è‡ªå‹•å‡ºå¸­ãƒ•ã‚©ãƒ¼ãƒ  chrome.zip` ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒ»å±•é–‹
                      2. Chromeæ‹¡å¼µæ©Ÿèƒ½ãƒšãƒ¼ã‚¸ã§ã€Œãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–ã•ã‚Œã¦ã„ãªã„æ‹¡å¼µæ©Ÿèƒ½ã‚’èª­ã¿è¾¼ã‚€ã€

                      ### Firefoxï¼ˆæœªç½²åç‰ˆï¼‰
                      1. `è‡ªå‹•å‡ºå¸­ãƒ•ã‚©ãƒ¼ãƒ  firefox.zip` ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒ»å±•é–‹  
                      2. `about:debugging` â†’ ã€Œä¸€æ™‚çš„ãªã‚¢ãƒ‰ã‚ªãƒ³ã€â†’ `manifest.json` ã‚’é¸æŠ

                      âš ï¸ **æ³¨æ„**: Firefoxç‰ˆã¯å†èµ·å‹•ã§ç„¡åŠ¹åŒ–ã•ã‚Œã¾ã™

                      ### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«è©³ç´°
                      - [Chrome ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚¬ã‚¤ãƒ‰](https://github.com/${{ github.repository }}/blob/main/docs/install-chrome.md)
                      - [Firefox ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚¬ã‚¤ãƒ‰](https://github.com/${{ github.repository }}/blob/main/docs/install-firefox.md)
              env:
                  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
